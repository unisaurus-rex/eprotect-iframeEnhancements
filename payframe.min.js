/*
 * Litle & Co. Pay Fame Java Script API Version: 1.0 Copyright Â© 2003-2015,
 * Litle & Co. ALL RIGHTS RESERVED. Includes payframe.js https://www.litle.com
 */
$(document).ready(function() {
    $("#accountNumber").focus(function() {
        $(".numberDiv").removeClass("error error-871 error-872 error-874 error-876")
    });
    $("#cvv").focus(function() {
        $(".cvvDiv").removeClass("error error-881 error-882")
    });
    var a = {
        ready: true
    };
    var b = "/" + $("#appPath").val() + "/js/json2-20140404.min.js";
    yepnope({
        test: window.JSON,
        nope: [b],
        complete: function() {
            window.parent.postMessage(JSON.stringify(a), "*")
        }
    });
    jQuery(document).click(function(c) {
        var d = jQuery(".title");
        if (d.length) {
            d.remove()
        }
    })
});
var eProtectPayFrame = function() {
    var h = false;
    var g = function(m) {
        m.expMonth = jQuery("#expMonth").val();
        m.expYear = jQuery("#expYear").val();
        $("#cvv").val("XXX");
        window.parent.postMessage(JSON.stringify(m), "*")
    };
    var i = function(m) {
        var n = m.response;
        if (n === "871") {
            $(".numberDiv").addClass("error");
            $(".numberDiv").addClass("error-871")
        } else {
            if (n === "872") {
                $(".numberDiv").addClass("error");
                $(".numberDiv").addClass("error-872")
            } else {
                if (n === "874") {
                    $(".numberDiv").addClass("error");
                    $(".numberDiv").addClass("error-874")
                } else {
                    if (n === "876") {
                        $(".numberDiv").addClass("error");
                        $(".numberDiv").addClass("error-876")
                    } else {
                        if (n === "881") {
                            $(".cvvDiv").addClass("error");
                            $(".cvvDiv").addClass("error-881")
                        } else {
                            if (n === "882") {
                                $(".cvvDiv").addClass("error");
                                $(".cvvDiv").addClass("error-882")
                            }
                        }
                    }
                }
            }
        }
        window.parent.postMessage(JSON.stringify(m), "*")
    };
    var d = function() {
        var m = {
            timeout: true
        };
        window.parent.postMessage(JSON.stringify(m), "*")
    };
    var c = function(o) {
        var n = {
            paypageId: o.paypageId,
            reportGroup: o.reportGroup,
            orderId: o.orderId,
            id: o.id,
            url: ""
        };
        if (o.pciNonSensitive) {
            n.pciNonSensitive = true
        }
        var m = {
            accountNum: document.getElementById("accountNumber"),
            paypageRegistrationId: document.getElementById("paypageRegistrationId"),
            bin: document.getElementById("bin")
        };
        if (h) {
            m.cvv2 = document.getElementById("cvv")
        }
        var q = o.timeout;
        if ($("#appPath").val() === "LitlePayPage") {
            var p = new LitlePayPage();
            p.sendToLitle(n, m, g, i, d, q)
        } else {
            var p = new eProtect();
            p.sendToEprotect(n, m, g, i, d, q)
        }
    };
    var k = function(m) {
        if (m) {
            jQuery(".cvvDiv").show();
            h = true
        } else {
            jQuery(".cvvDiv").hide();
            h = false
        }
    };
    var l = function(n) {
        var m = n;
        jQuery("#expMonth")[0][0].text = m["1"];
        jQuery("#expMonth")[0][1].text = m["2"];
        jQuery("#expMonth")[0][2].text = m["3"];
        jQuery("#expMonth")[0][3].text = m["4"];
        jQuery("#expMonth")[0][4].text = m["5"];
        jQuery("#expMonth")[0][5].text = m["6"];
        jQuery("#expMonth")[0][6].text = m["7"];
        jQuery("#expMonth")[0][7].text = m["8"];
        jQuery("#expMonth")[0][8].text = m["9"];
        jQuery("#expMonth")[0][9].text = m["10"];
        jQuery("#expMonth")[0][10].text = m["11"];
        jQuery("#expMonth")[0][11].text = m["12"]
    };
    var a = function(r) {
        var m = r;
        var s = jQuery("#expYear option").size();
        for (var q = 0; q < s; q++) {
            jQuery("#expYear option:first").remove()
        }
        var p = new Date().getFullYear();
        for (var n = 0; n < m; n++) {
            var t = new Option(p + n, p + n - 2000);
            jQuery(t).html(p + n);
            jQuery("#expYear").append(t)
        }
    };
    var b = function(m) {
        var n = m;
        jQuery(".tooltip").attr("title", n);
        jQuery(".tooltip").attr("style", "");
        jQuery(".tooltip").click(function(o) {
            var p = jQuery(".title");
            var q = jQuery(".cvvDiv");
            if (!p.length) {
                $(q).append('<span class="title" id="cvvTooltipTitle"></span>');
                $("#cvvTooltipTitle").text(n);
                $(".title").click(function() {})
            } else {
                p.remove()
            }
            return false
        })
    };
    var e = function(m) {
        if (m.cvv) {
            $("#cvv").attr("tabindex", m.cvv)
        }
        if (m.accountNumber) {
            $("#accountNumber").attr("tabindex", m.accountNumber)
        }
        if (m.expMonth) {
            $("#expMonth").attr("tabindex", m.expMonth)
        }
        if (m.expYear) {
            $("#expYear").attr("tabindex", m.expYear)
        }
    };
    var j = function(m) {
        if (m.cvv) {
            $("#cvv").attr("placeholder", m.cvv)
        }
        if (m.accountNumber) {
            $("#accountNumber").attr("placeholder", m.accountNumber)
        }
    };
    var f = function() {
        var p = document;
        var m = Math.max(Math.max(p.body.scrollHeight, p.documentElement.scrollHeight), Math.max(p.body.offsetHeight, p.documentElement.offsetHeight), Math.max(p.body.clientHeight, p.documentElement.clientHeight));
        var n = {
            height: m
        };
        var o = "/" + $("#appPath").val() + "/js/json2-20140404.min.js";
        yepnope({
            test: window.JSON,
            nope: [o],
            complete: function() {
                window.parent.postMessage(JSON.stringify(n), "*")
            }
        })
    };
    return {
        receivedMessageFromOuterFrame: function(m) {
            var n = m.action;
            if (n === "getPaypageRegistrationId") {
                c(m)
            } else {
                if (n === "configure") {
                    if (m.months) {
                        l(m.months)
                    }
                    if (m.numYears) {
                        a(m.numYears)
                    }
                    if (m.showCvv) {
                        k(m.showCvv)
                    }
                    if (m.tooltipText) {
                        b(m.tooltipText)
                    }
                    if (m.tabIndex) {
                        e(m.tabIndex)
                    }
                    if (m.placeholderText) {
                        j(m.placeholderText)
                    }
                } else {
                    if (n === "getDocHeight") {
                        f()
                    } else {}
                }
            }
        }
    }
};
var epFrame = new eProtectPayFrame();
var eventHandler = function(c) {
    var b = c.data;
    var a = "/" + $("#appPath").val() + "/js/json2-20140404.min.js";
    yepnope({
        test: window.JSON,
        nope: [a],
        complete: function() {
            var d = JSON.parse(b);
            epFrame.receivedMessageFromOuterFrame(d)
        }
    })
};
if (window.addEventListener) {
    window.addEventListener("message", eventHandler, false)
} else {
    if (window.attachEvent) {
        window.attachEvent("onmessage", eventHandler)
    }
};